import React, { useState, useEffect, useRef } from 'react';
import { Trophy, Users, MessageSquare, Globe, ChevronRight, ChevronLeft, Heart, Star, Crown, Shield, Zap, Flame, Target, Clock, Award, Gift, Music, Volume2, VolumeX, CheckCircle, XCircle, Play, Pause, SkipForward, SkipBack, MoreHorizontal, Instagram, ChevronDown, ChevronUp, Menu, X } from 'lucide-react';

// Types
interface Player {
  id: string;
  name: string;
  score: number;
  level: number;
  isOnline: boolean;
  deviceId: string;
  isWinner: boolean;
}

interface Match {
  id: string;
  player1: string;
  player2: string;
  score1: number;
  score2: number;
  stage: string;
  isLive: boolean;
  winner: string | null;
}

interface Message {
  id: string;
  user: string;
  text: string;
  timestamp: Date;
  deviceId: string;
}

interface Question {
  id: number;
  question: string;
  options: string[];
  correctAnswer: number;
  difficulty: 'easy' | 'medium' | 'hard';
}

// API Configuration for Global Player Data
const API_CONFIG = {
  endpoint: 'https://api.pixabay.com/api/',
  key: '698ec55bd0ea881f40b6b5e3',
  passwordHash: '$2a$10$zP2nglkzKrG1K81/D3uY1ejRP73C/zxIpE9QiFtYPOS2pU9saHnU.'
};

// Single background music track
const BACKGROUND_MUSIC = 'https://cdn.pixabay.com/download/audio/2023/10/02/audio_2_cyrw.mp3?filename=background-music-2497.mp3';

// Questions sets (changes after each tournament)
const QUESTION_SETS = {
  set1: {
    ar: [
      { id: 1, question: "Ù…Ø§ Ù‡Ùˆ Ø¹Ø§ØµÙ…Ø© ÙØ±Ù†Ø³Ø§ØŸ", options: ["Ø¨Ø§Ø±ÙŠØ³", "Ù„Ù†Ø¯Ù†", "Ø¨Ø±Ù„ÙŠÙ†", "Ø±ÙˆÙ…Ø§"], correctAnswer: 0, difficulty: 'easy' },
      { id: 2, question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŸ", options: ["5", "6", "7", "8"], correctAnswer: 2, difficulty: 'easy' },
      { id: 3, question: "Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± ÙƒÙˆÙƒØ¨ ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©ØŸ", options: ["Ø§Ù„Ø£Ø±Ø¶", "Ø§Ù„Ù…Ø±ÙŠØ®", "Ø§Ù„Ù…Ø´ØªØ±ÙŠ", "Ø²Ø­Ù„"], correctAnswer: 2, difficulty: 'medium' },
      { id: 4, question: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ØŸ", options: ["Ø³ÙˆÙ„", "Ø¨ÙƒÙŠÙ†", "Ø·ÙˆÙƒÙŠÙˆ", "Ø³Ø§ÙŠØºÙˆÙ†"], correctAnswer: 2, difficulty: 'medium' },
      { id: 5, question: "Ù…Ù† ÙƒØªØ¨ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…ØŸ", options: ["Ù…Ø­Ù…Ø¯", "Ø§Ù„Ù„Ù‡", "Ø£Ø¨Ùˆ Ø¨ÙƒØ±", "Ø¹Ù…Ø±"], correctAnswer: 1, difficulty: 'hard' },
      { id: 6, question: "Ù…Ø§ Ù‡Ùˆ Ø£ØµØºØ± Ø¯ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options: ["Ù…ÙˆÙ†Ø§ÙƒÙˆ", "ÙĞ°Ñ‚Ğ¸ÙƒØ§Ù†", "ï¿½×Ÿ Ù…Ø§Ø±ÙŠÙ†Ùˆ", "Ù„ÙŠØ®ØªÙ†Ø´ØªØ§ÙŠÙ†"], correctAnswer: 1, difficulty: 'hard' }
    ],
    en: [
      { id: 1, question: "What is the capital of France?", options: ["Paris", "London", "Berlin", "Rome"], correctAnswer: 0, difficulty: 'easy' },
      { id: 2, question: "How many days are in a week?", options: ["5", "6", "7", "8"], correctAnswer: 2, difficulty: 'easy' },
      { id: 3, question: "What is the largest planet in our solar system?", options: ["Earth", "Mars", "Jupiter", "Saturn"], correctAnswer: 2, difficulty: 'medium' },
      { id: 4, question: "What is the capital of Japan?", options: ["Seoul", "Beijing", "Tokyo", "Saigon"], correctAnswer: 2, difficulty: 'medium' },
      { id: 5, question: "Who wrote the Holy Quran?", options: ["Muhammad", "Allah", "Abu Bakr", "Umar"], correctAnswer: 1, difficulty: 'hard' },
      { id: 6, question: "What is the smallest country in the world?", options: ["Monaco", "Vatican", "San Marino", "Liechtenstein"], correctAnswer: 1, difficulty: 'hard' }
    ]
  },
  set2: {
    ar: [
      { id: 1, question: "Ù…Ø§ Ù‡Ùˆ Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±ÙŠØŸ", options: ["H2O", "O2", "H", "H2O2"], correctAnswer: 0, difficulty: 'easy' },
      { id: 2, question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options: ["5", "6", "7", "8"], correctAnswer: 2, difficulty: 'easy' },
      { id: 3, question: "Ù…Ø§ Ù‡Ùˆ Ø£Ø¹Ù…Ù‚ Ù…Ø­ÙŠØ· ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options: ["Ø§Ù„Ø£Ø·Ù„Ø³ÙŠ", "Ø§Ù„Ù‡Ù†Ø¯ÙŠ", "Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ù‡Ø§Ø¯Ø¦", "Ø§Ù„Ù‚Ø·Ø¨ÙŠ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ"], correctAnswer: 2, difficulty: 'medium' },
      { id: 4, question: "Ù…Ù† Ù‡Ùˆ Ù…Ø¤Ø³Ø³ Ø´Ø±ÙƒØ© Ù…Ø§ÙŠÙƒØ±ÙˆØ³ÙˆÙØªØŸ", options: ["Ø³ØªÙŠÙ Ø¬ÙˆØ¨Ø²", "Ø¨ÙŠÙ„ ØºÙŠØªØ³", "Ù…Ø§Ø±Ùƒ Ø²ÙˆÙƒØ±Ø¨ÙŠØ±Ø¬", "Ù„Ø§Ø±ÙŠ Ø¨ÙŠØ¬"], correctAnswer: 1, difficulty: 'medium' },
      { id: 5, question: "Ù…Ø§ Ù‡Ùˆ Ø£Ù‚ØµØ± Ø­Ø±Ø¨ ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŸ", options: ["5 Ø¯Ù‚Ø§Ø¦Ù‚", "10 Ø¯Ù‚Ø§Ø¦Ù‚", "15 Ø¯Ù‚ÙŠÙ‚Ø©", "30 Ø¯Ù‚ÙŠÙ‚Ø©"], correctAnswer: 1, difficulty: 'hard' },
      { id: 6, question: "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙŠ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠÙ‡Ø§ Ø´ÙˆØ§Ø±Ø¹ØŸ", options: ["Ù…ÙˆÙ†Ø§ÙƒÙˆ", "ÙĞ°Ñ‚Ğ¸ÙƒØ§Ù†", "Ø³Ù† Ù…Ø§Ø±ÙŠÙ†Ùˆ", "Ù„ÙŠØ®ØªÙ†Ø´ØªØ§ÙŠÙ†"], correctAnswer: 1, difficulty: 'hard' }
    ],
    en: [
      { id: 1, question: "What is the chemical formula for water?", options: ["H2O", "O2", "H", "H2O2"], correctAnswer: 0, difficulty: 'easy' },
      { id: 2, question: "How many continents are there?", options: ["5", "6", "7", "8"], correctAnswer: 2, difficulty: 'easy' },
      { id: 3, question: "What is the deepest ocean in the world?", options: ["Atlantic", "Indian", "Pacific", "Arctic"], correctAnswer: 2, difficulty: 'medium' },
      { id: 4, question: "Who founded Microsoft?", options: ["Steve Jobs", "Bill Gates", "Mark Zuckerberg", "Larry Page"], correctAnswer: 1, difficulty: 'medium' },
      { id: 5, question: "What was the shortest war in history?", options: ["5 minutes", "10 minutes", "15 minutes", "30 minutes"], correctAnswer: 1, difficulty: 'hard' },
      { id: 6, question: "Which country has no streets?", options: ["Monaco", "Vatican", "San Marino", "Liechtenstein"], correctAnswer: 1, difficulty: 'hard' }
    ]
  },
  set3: {
    ar: [
      { id: 1, question: "Ù…Ø§ Ù‡Ùˆ Ø¹Ø¯Ø¯ Ø£Ù„ÙˆØ§Ù† Ù‚ÙˆØ³ Ø§Ù„Ù‚Ø²Ø­ØŸ", options: ["5", "6", "7", "8"], correctAnswer: 2, difficulty: 'easy' },
      { id: 2, question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„Ø°ÙŠ ÙŠÙ†Ø§Ù… ÙˆØ§Ù‚ÙØ§Ù‹ØŸ", options: ["Ø§Ù„Ø£Ø±Ù†Ø¨", "Ø§Ù„Ø­ØµØ§Ù†", "Ø§Ù„ÙƒÙ„Ø¨", "Ø§Ù„Ù‚Ø·"], correctAnswer: 1, difficulty: 'easy' },
      { id: 3, question: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© ÙƒÙ†Ø¯Ø§ØŸ", options: ["ØªÙˆØ±ÙˆÙ†ØªÙˆ", "ÙØ§Ù†ÙƒÙˆÙØ±", "Ø£ÙˆØªØ§ÙˆØ§", "Ùƒalgary"], correctAnswer: 2, difficulty: 'medium' },
      { id: 4, question: "Ù…Ù† Ù‡Ùˆ Ù…ÙƒØªØ´Ù Ø£Ù…Ø±ÙŠÙƒØ§ØŸ", options: ["ÙØ§Ø³ÙƒÙˆ Ø¯Ø§ ØºØ§Ù…Ø§", "ÙƒØ±ÙŠØ³ØªÙˆÙØ± ÙƒÙˆÙ„ÙˆÙ…Ø¨ÙˆØ³", "Ù…Ø§Ø±ÙƒÙˆ Ø¨ÙˆÙ„Ùˆ", "Ø£ãƒ¡ãƒªØºÙˆ ÙÙŠØ³Ø¨ÙˆØªØ´ÙŠ"], correctAnswer: 1, difficulty: 'medium' },
      { id: 5, question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø£ÙƒØ«Ø± Ù‚Ø±Ø§Ø¡Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options: ["harry Potter", "Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…", "Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ù‚Ø¯Ø³", "Don Quixote"], correctAnswer: 1, difficulty: 'hard' },
      { id: 6, question: "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙŠ ØªÙ… ÙÙŠÙ‡Ø§ Ø§Ø®ØªØ±Ø§Ø¹ Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©ØŸ", options: ["Ø¨Ù„Ø¬ÙŠÙƒØ§", "Ø³ÙˆÙŠØ³Ø±Ø§", "Ø£Ù„Ù…Ø§Ù†ÙŠØ§", "Ø¥ÙŠØ·Ø§Ù„ÙŠØ§"], correctAnswer: 0, difficulty: 'hard' }
    ],
    en: [
      { id: 1, question: "How many colors are in a rainbow?", options: ["5", "6", "7", "8"], correctAnswer: 2, difficulty: 'easy' },
      { id: 2, question: "Which animal sleeps standing up?", options: ["Rabbit", "Horse", "Dog", "Cat"], correctAnswer: 1, difficulty: 'easy' },
      { id: 3, question: "What is the capital of Canada?", options: ["Toronto", "Vancouver", "Ottawa", "Calgary"], correctAnswer: 2, difficulty: 'medium' },
      { id: 4, question: "Who discovered America?", options: ["Vasco da Gama", "Christopher Columbus", "Marco Polo", "Amerigo Vespucci"], correctAnswer: 1, difficulty: 'medium' },
      { id: 5, question: "What is the most read book in the world?", options: ["Harry Potter", "The Quran", "The Bible", "Don Quixote"], correctAnswer: 1, difficulty: 'hard' },
      { id: 6, question: "Which country invented chocolate?", options: ["Belgium", "Switzerland", "Germany", "Italy"], correctAnswer: 0, difficulty: 'hard' }
    ]
  }
};

// Champions League Stage Structure
const STAGES = {
  groups: { name: 'Ø¯ÙˆØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª', participants: 20, matches: [] },
  round16: { name: 'Ø¯ÙˆØ± Ø§Ù„Ù€16', participants: 8, matches: [] },
  quarter: { name: 'Ø±Ø¨Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', participants: 4, matches: [] },
  semi: { name: 'Ù†ØµÙ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', participants: 2, matches: [] },
  final: { name: 'Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', participants: 1, matches: [] }
};

const App: React.FC = () => {
  const [language, setLanguage] = useState<'ar' | 'en'>('ar');
  const [currentTab, setCurrentTab] = useState<'home' | 'leaderboard' | 'live' | 'friends' | 'history'>('home');
  const [players, setPlayers] = useState<Player[]>([]);
  const [currentPlayer, setCurrentPlayer] = useState<Player | null>(null);
  const [matches, setMatches] = useState<Match[]>([]);
  const [messages, setMessages] = useState<Message[]>([]);
  const [newMessage, setNewMessage] = useState('');
  const [isTournamentActive, setIsTournamentActive] = useState(false);
  const [tournamentStage, setTournamentStage] = useState('groups');
  const [questions, setQuestions] = useState<Question[]>([]);
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [lives, setLives] = useState(5);
  const [timeLeft, setTimeLeft] = useState(15);
  const [isPlaying, setIsPlaying] = useState(false);
  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null);
  const [showResult, setShowResult] = useState(false);
  const [resultMessage, setResultMessage] = useState('');
  const [isMusicPlaying, setIsMusicPlaying] = useState(false);
  const [currentMusicIndex, setCurrentMusicIndex] = useState(0);
  const [questionSetVersion, setQuestionSetVersion] = useState(1);
  const [gameHistory, setGameHistory] = useState<Match[]>([]);
  
  const audioRef = useRef<HTMLAudioElement>(null);
  const deviceId = useRef<string>('');
  const animationFrameRef = useRef<number>();

  // Initialize device ID and load saved data
  useEffect(() => {
    const savedDeviceId = localStorage.getItem('gowin_device_id');
    if (savedDeviceId) {
      deviceId.current = savedDeviceId;
    } else {
      deviceId.current = `device_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
      localStorage.setItem('gowin_device_id', deviceId.current);
    }

    // Load saved players
    const savedPlayers = localStorage.getItem('gowin_players');
    if (savedPlayers) {
      setPlayers(JSON.parse(savedPlayers));
    }

    // Load saved messages
    const savedMessages = localStorage.getItem('gowin_messages');
    if (savedMessages) {
      setMessages(JSON.parse(savedMessages));
    }

    // Load game history
    const savedHistory = localStorage.getItem('gowin_history');
    if (savedHistory) {
      setGameHistory(JSON.parse(savedHistory));
    }

    // Load current player
    const savedCurrentPlayer = localStorage.getItem('gowin_current_player');
    if (savedCurrentPlayer) {
      setCurrentPlayer(JSON.parse(savedCurrentPlayer));
    }

    // Load question set version
    const savedVersion = localStorage.getItem('gowin_question_version');
    if (savedVersion) {
      setQuestionSetVersion(parseInt(savedVersion));
    }
  }, []);

  // Save data whenever it changes
  useEffect(() => {
    if (players.length > 0) {
      localStorage.setItem('gowin_players', JSON.stringify(players));
    }
  }, [players]);

  useEffect(() => {
    if (messages.length > 0) {
      localStorage.setItem('gowin_messages', JSON.stringify(messages));
    }
  }, [messages]);

  useEffect(() => {
    if (currentPlayer) {
      localStorage.setItem('gowin_current_player', JSON.stringify(currentPlayer));
    }
  }, [currentPlayer]);

  useEffect(() => {
    if (gameHistory.length > 0) {
      localStorage.setItem('gowin_history', JSON.stringify(gameHistory));
    }
  }, [gameHistory]);

  // Music auto-play on screen touch
  useEffect(() => {
    const handleFirstInteraction = () => {
      if (audioRef.current && !isMusicPlaying) {
        audioRef.current.volume = 0.3;
        audioRef.current.play().then(() => {
          setIsMusicPlaying(true);
        }).catch(e => console.log('Auto-play failed:', e));
      }
    };

    document.addEventListener('click', handleFirstInteraction, { once: true });
    document.addEventListener('touchstart', handleFirstInteraction, { once: true });

    return () => {
      document.removeEventListener('click', handleFirstInteraction);
      document.removeEventListener('touchstart', handleFirstInteraction);
    };
  }, [isMusicPlaying]);

  // Music management
  useEffect(() => {
    if (isMusicPlaying && audioRef.current) {
      audioRef.current.volume = 0.3;
      
      const handleEnded = () => {
        // Since we have only one music, just replay it
        if (audioRef.current) {
          audioRef.current.currentTime = 0;
          audioRef.current.play().catch(e => console.log('Replay failed:', e));
        }
      };

      audioRef.current.addEventListener('ended', handleEnded);
      return () => {
        if (audioRef.current) {
          audioRef.current.removeEventListener('ended', handleEnded);
        }
      };
    }
  }, [isMusicPlaying]);

  // Pause music when page is hidden
  useEffect(() => {
    const handleVisibilityChange = () => {
      if (document.hidden && audioRef.current) {
        audioRef.current.pause();
        setIsMusicPlaying(false);
      }
    };

    document.addEventListener('visibilitychange', handleVisibilityChange);
    return () => document.removeEventListener('visibilitychange', handleVisibilityChange);
  }, []);

  // Timer for questions
  useEffect(() => {
    if (isPlaying && timeLeft > 0) {
      const timer = setTimeout(() => {
        setTimeLeft(timeLeft - 1);
      }, 1000);
      return () => clearTimeout(timer);
    } else if (timeLeft === 0 && isPlaying) {
      handleAnswer(-1); // Time's up
    }
  }, [isPlaying, timeLeft]);

  const getQuestions = () => {
    const setKey = `set${questionSetVersion}` as keyof typeof QUESTION_SETS;
    const questionsSet = QUESTION_SETS[setKey];
    return language === 'ar' ? questionsSet.ar : questionsSet.en;
  };

  const startGame = (playerName: string) => {
    if (players.length >= 20) {
      alert(language === 'ar' ? 'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ù…Ù…ØªÙ„Ø¦ Ø¨Ø§Ù„ÙØ¹Ù„!' : 'Tournament is full!');
      return;
    }

    const newPlayer: Player = {
      id: `player_${Date.now()}`,
      name: playerName,
      score: 0,
      level: 1,
      isOnline: true,
      deviceId: deviceId.current,
      isWinner: false
    };

    setCurrentPlayer(newPlayer);
    setQuestions(getQuestions());
    setIsPlaying(true);
    setScore(0);
    setLives(5);
    setCurrentQuestionIndex(0);
    setTimeLeft(15);
    setShowResult(false);
  };

  const handleAnswer = (answerIndex: number) => {
    if (!isPlaying || selectedAnswer !== null) return;

    setSelectedAnswer(answerIndex);
    const currentQ = questions[currentQuestionIndex];
    const isCorrect = answerIndex === currentQ.correctAnswer;

    setTimeout(() => {
      if (isCorrect) {
        const points = currentQ.difficulty === 'easy' ? 10 : currentQ.difficulty === 'medium' ? 20 : 30;
        setScore(prev => prev + points);
        setResultMessage(language === 'ar' ? `Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! +${points} Ù†Ù‚Ø·Ø©` : `Correct! +${points} points`);
      } else {
        setLives(prev => {
          const newLives = prev - 1;
          if (newLives <= 0) {
            endGame();
          }
          return newLives;
        });
        setResultMessage(language === 'ar' ? 'Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©!' : 'Wrong answer!');
      }

      setTimeout(() => {
        setSelectedAnswer(null);
        setShowResult(false);
        
        if (currentQuestionIndex < questions.length - 1) {
          setCurrentQuestionIndex(prev => prev + 1);
          setTimeLeft(15);
        } else {
          endGame();
        }
      }, 2000);
    }, 1000);
  };

  const endGame = () => {
    setIsPlaying(false);
    if (currentPlayer) {
      const updatedPlayer = { ...currentPlayer, score };
      setPlayers(prev => [...prev, updatedPlayer]);
      setCurrentPlayer(updatedPlayer);

      // Check if this player is the winner
      if (players.length === 19) { // Will be 20th player
        setResultMessage(language === 'ar' ? 'Ù…Ø¨Ø±ÙˆÙƒ! Ø£Ù†Øª Ø§Ù„ÙØ§Ø¦Ø² Ø¨Ø§Ù„Ù„Ù‚Ø¨!' : 'Congratulations! You are the champion!');
      }
    }
  };

  const startTournament = () => {
    if (players.length < 20) return;
    
    setIsTournamentActive(true);
    generateMatches();
  };

  const generateMatches = () => {
    const sortedPlayers = [...players].sort((a, b) => b.score - a.score);
    const newMatches: Match[] = [];

    // Generate group stage matches (simplified)
    for (let i = 0; i < 20; i += 2) {
      newMatches.push({
        id: `match_${Date.now()}_${i}`,
        player1: sortedPlayers[i].name,
        player2: sortedPlayers[i + 1].name,
        score1: Math.floor(Math.random() * 3),
        score2: Math.floor(Math.random() * 3),
        stage: 'Ø¯ÙˆØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª',
        isLive: true,
        winner: null
      });
    }

    setMatches(newMatches);
    
    // Update game history
    setGameHistory(prev => [...prev, ...newMatches]);

    // Change questions for next tournament
    setQuestionSetVersion(prev => (prev % 3) + 1);
    localStorage.setItem('gowin_question_version', ((questionSetVersion % 3) + 1).toString());
  };

  const sendMessage = () => {
    if (!newMessage.trim() || !currentPlayer) return;

    const message: Message = {
      id: `msg_${Date.now()}`,
      user: currentPlayer.name,
      text: newMessage,
      timestamp: new Date(),
      deviceId: deviceId.current
    };

    setMessages(prev => [...prev, message]);
    setNewMessage('');
  };

  const getPlayerRank = (player: Player) => {
    const sortedPlayers = [...players].sort((a, b) => b.score - a.score);
    return sortedPlayers.findIndex(p => p.id === player.id) + 1;
  };

  const getRankTitle = (rank: number) => {
    if (rank === 1) return language === 'ar' ? 'ğŸ Golden The Goat' : 'ğŸ Golden The Goat';
    if (rank === 2) return language === 'ar' ? 'ğŸ¥ˆ The Legend' : 'ğŸ¥ˆ The Legend';
    if (rank === 3) return language === 'ar' ? 'ğŸ¥‰ The Hero' : 'ğŸ¥‰ The Hero';
    if (rank <= 8) return language === 'ar' ? 'âš¡ The Champion' : 'âš¡ The Champion';
    if (rank <= 16) return language === 'ar' ? 'ğŸ”¥ The Warrior' : 'ğŸ”¥ The Warrior';
    return language === 'ar' ? 'ğŸ’ª The Fighter' : 'ğŸ’ª The Fighter';
  };

  const getRankColor = (rank: number) => {
    if (rank === 1) return 'text-yellow-400';
    if (rank === 2) return 'text-gray-300';
    if (rank === 3) return 'text-amber-600';
    if (rank <= 8) return 'text-blue-400';
    if (rank <= 16) return 'text-red-400';
    return 'text-green-400';
  };

  const getDifficultyColor = (difficulty: string) => {
    switch (difficulty) {
      case 'easy': return 'text-green-400';
      case 'medium': return 'text-yellow-400';
      case 'hard': return 'text-red-400';
      default: return 'text-gray-400';
    }
  };

  const renderTab = () => {
    switch (currentTab) {
      case 'home':
        return renderHomeTab();
      case 'leaderboard':
        return renderLeaderboardTab();
      case 'live':
        return renderLiveTab();
      case 'friends':
        return renderFriendsTab();
      case 'history':
        return renderHistoryTab();
      default:
        return renderHomeTab();
    }
  };

  const renderHomeTab = () => (
    <div className="animate-fade-in">
      {/* Animated Banner */}
      <div className="relative mb-8 overflow-hidden rounded-3xl bg-gradient-to-r from-yellow-600 via-yellow-500 to-yellow-600 shadow-2xl shadow-yellow-500/50">
        <div className="absolute inset-0 bg-black/20"></div>
        <div className="absolute inset-0 shimmer-animation"></div>
        
        {/* Floating particles */}
        {[...Array(12)].map((_, i) => (
          <div
            key={i}
            className="absolute w-2 h-2 bg-white/30 rounded-full animate-float"
            style={{
              left: `${Math.random() * 100}%`,
              top: `${Math.random() * 100}%`,
              animationDelay: `${Math.random() * 3}s`,
              animationDuration: `${3 + Math.random() * 4}s`
            }}
          />
        ))}
        
        <div className="relative z-10 p-6 text-center">
          <div classNode string="ğŸ‘‘"> </div>
          <h1 className="text-4xl md:text-5xl font-black text-white mb-2 animate-pulse">
            {language === 'ar' ? 'Golden The Goat' : 'Golden The Goat'}
          </h1>
          <p className="text-lg text-yellow-100">
            {language === 'ar' ? 'Ø£ØµØ¨Ø­ Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©' : 'Become the legend'}
          </p>
          <div className="mt-4 flex justify-center gap-8 text-yellow-200">
            <span>{language === 'ar' ? 'Ù„Ù‚Ø¨ ÙˆØ§Ø­Ø¯' : 'One Title'}</span>
            <span>{language === 'ar' ? '20 Ù…ØªÙ†Ø§ÙØ³' : '20 Competitors'}</span>
            <span>{language === 'ar' ? 'Ù…Ø¬Ø¯ Ø£Ø¨Ø¯ÙŠ' : 'Eternal Glory'}</span>
          </div>
        </div>
      </div>

      {/* Motivational Text */}
      <div className="text-center mb-8">
        <p className="text-xl text-purple-300 font-bold">
          {language === 'ar' ? 'ğŸš€ Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ Ø§Ù„ØªÙ…ÙŠØ² - ÙÙ‚Ø· 20 Ù„Ø§Ø¹Ø¨ Ø³ÙŠØªØ£Ù‡Ù„ÙˆÙ†!' : 'ğŸš€ Start your journey to excellence - Only 20 players will qualify!'}
        </p>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div className="bg-gradient-to-br from-purple-900/50 to-purple-800/30 p-4 rounded-xl border border-purple-500/30 text-center transform hover:scale-105 transition-transform duration-200">
          <div className="text-3xl font-bold text-purple-300">{players.length}</div>
          <div className="text-purple-400">{language === 'ar' ? 'Ù„Ø§Ø¹Ø¨ Ù…Ø³Ø¬Ù„' : 'Registered Players'}</div>
        </div>
        <div className="bg-gradient-to-br from-yellow-900/50 to-yellow-800/30 p-4 rounded-xl border border-yellow-500/30 text-center transform hover:scale-105 transition-transform duration-200">
          <div className="text-3xl font-bold text-yellow-300">{players.filter(p => p.isOnline).length}</div>
          <div className="text-yellow-400">{language === 'ar' ? 'Ù…ØªØ£Ù‡Ù„ Ù„Ù„Ø¯ÙˆØ±ÙŠ' : 'Qualified for Tournament'}</div>
        </div>
        <div className="bg-gradient-to-br from-pink-900/50 to-pink-800/30 p-4 rounded-xl border border-pink-500/30 text-center transform hover:scale-105 transition-transform duration-200">
          <div className="text-3xl font-bold text-pink-300">{players.length >= 20 ? '1' : '0'}</div>
          <div className="text-pink-400">{language === 'ar' ? 'Golden The Goat' : 'Golden The Goat'}</div>
        </div>
      </div>

      {/* Start Game Button */}
      <div className="text-center mb-8">
        {players.length < 20 ? (
          <button
            onClick={() => {
              const playerName = prompt(language === 'ar' ? 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:' : 'Enter your name:');
              if (playerName) startGame(playerName);
            }}
            className="bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white font-bold py-4 px-8 rounded-full text-xl shadow-lg transform hover:scale-105 transition-all duration-200 animate-pulse"
          >
            {language === 'ar' ? 'ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ' : 'ğŸš€ Start Challenge'}
          </button>
        ) : (
          <div className="bg-red-900/50 border border-red-500 rounded-xl p-4 text-center">
            <p className="text-red-300 font-bold">{language === 'ar' ? 'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ù…Ù…ØªÙ„Ø¦ - FULL' : 'Tournament is FULL'}</p>
          </div>
        )}
      </div>

      {/* How It Works */}
      <div className="bg-slate-800/30 rounded-2xl p-6 border border-slate-600/30">
        <h3 className="text-xl font-bold text-white mb-4 text-center">
          {language === 'ar' ? 'ÙƒÙŠÙ ØªØ¹Ù…Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©ØŸ' : 'How It Works?'}
        </h3>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div className="text-center">
            <div className="text-3xl mb-2">ğŸ®</div>
            <p className="text-slate-300">{language === 'ar' ? 'Ø³Ø¬Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ' : 'Register and start challenge'}</p>
          </div>
          <div className="text-center">
            <div className="text-3xl mb-2">â±ï¸</div>
            <p className="text-slate-300">{language === 'ar' ? '15 Ø«Ø§Ù†ÙŠØ© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„' : '15 seconds per question'}</p>
          </div>
          <div className="text-center">
            <div className="text-3xl mb-2">ğŸ†</div>
            <p className="text-slate-300">{language === 'ar' ? 'Ø£ÙˆÙ„ 20 Ù„Ø§Ø¹Ø¨ ÙŠØ¯Ø®Ù„ÙˆÙ† Ø§Ù„Ø¯ÙˆØ±ÙŠ' : 'Top 20 enter tournament'}</p>
          </div>
        </div>
      </div>
    </div>
  );

  const renderLeaderboardTab = () => (
    <div className="animate-fade-in">
      <h2 className="text-3xl font-bold text-white mb-6 text-center">
        {language === 'ar' ? 'ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†' : 'ğŸ“Š Leaderboard'}
      </h2>
      
      {/* Motivational Text */}
      <div className="text-center mb-6">
        <p className="text-lg text-purple-300">
          {language === 'ar' ? 'ğŸ“Š Ø§Ù„ØªØ±ØªÙŠØ¨ ÙŠØªØºÙŠØ± ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© - Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù…Ø±ÙƒØ²Ùƒ!' : 'ğŸ“Š Rankings change every second - Keep your position!'}
        </p>
      </div>

      <div className="space-y-3 max-h-96 overflow-y-auto pr-2">
        {[...players]
          .sort((a, b) => b.score - a.score)
          .slice(0, 20)
          .map((player, index) => {
            const rank = index + 1;
            const isCurrentPlayer = currentPlayer && player.id === currentPlayer.id;
            
            return (
              <div
                key={player.id}
                className={`bg-slate-800/50 rounded-xl p-4 border transition-all duration-200 ${
                  isCurrentPlayer ? 'border-purple-500 bg-purple-900/30' : 'border-slate-600/30'
                } hover:scale-[1.02]`}
              >
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-4">
                    <div className={`text-2xl font-bold ${getRankColor(rank)}`}>
                      {rank}
                    </div>
                    <div>
                      <div className="font-bold text-white flex items-center gap-2">
                        {player.name}
                        {isCurrentPlayer && (
                          <span className="text-xs bg-purple-600 px-2 py-1 rounded-full">
                            {language === 'ar' ? 'Ø£Ù†Øª' : 'YOU'}
                          </span>
                        )}
                      </div>
                      <div className="text-sm text-slate-400">
                        {language === 'ar' ? 'Ø§Ù„Ù†Ù‚Ø§Ø·:' : 'Score:'} {player.score}
                      </div>
                    </div>
                  </div>
                  <div className={`text-lg font-bold ${getRankColor(rank)}`}>
                    {getRankTitle(rank)}
                  </div>
                </div>
              </div>
            );
          })}
      </div>

      {players.length === 0 && (
        <div className="text-center text-slate-400 mt-8">
          <p>{language === 'ar' ? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ø¹Ø¯' : 'No players yet'}</p>
        </div>
      )}
    </div>
  );

  const renderLiveTab = () => (
    <div className="animate-fade-in">
      <h2 className="text-3xl font-bold text-white mb-6 text-center">
        {language === 'ar' ? 'ğŸ”´ Ù…Ø¨Ø§Ø´Ø± - Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù„Ø§ÙŠÙ' : 'ğŸ”´ LIVE - Matches'}
      </h2>

      {/* Motivational Text */}
      <div className="text-center mb-6">
        <p className="text-lg text-red-400 font-bold">
          {language === 'ar' ? 'âš¡ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© ØªØ¨Ø¯Ø£ Ø§Ù„Ø¢Ù† - ÙÙ‚Ø· 8 Ø³ÙŠØªØ£Ù‡Ù„ÙˆÙ†!' : 'âš¡ The battle begins now - Only 8 will qualify!'}
        </p>
      </div>

      {isTournamentActive ? (
        <div className="space-y-4">
          <div className="bg-red-900/50 border border-red-500 rounded-xl p-4 text-center">
            <div className="text-red-300 font-bold text-xl animate-pulse">
              ğŸ”´ {language === 'ar' ? 'LIVE - Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø§Ø¨Ù‚' : 'LIVE - In Progress'}
            </div>
          </div>

          {matches.map(match => (
            <div
              key={match.id}
              className="bg-slate-800/50 rounded-xl p-4 border border-slate-600/30"
            >
              <div className="flex items-center justify-between mb-2">
                <div className="text-sm text-slate-400">{match.stage}</div>
                <div className="text-xs bg-red-600 px-2 py-1 rounded-full text-white animate-pulse">
                  LIVE
                </div>
              </div>
              <div className="flex items-center justify-between">
                <div className="flex-1 text-center">
                  <div className="font-bold text-white">{match.player1}</div>
                  <div className="text-2xl font-bold text-green-400">{match.score1}</div>
                </div>
                <div className="mx-4 text-slate-400">VS</div>
                <div className="flex-1 text-center">
                  <div className="font-bold text-white">{match.player2}</div>
                  <div className="text-2xl font-bold text-red-400">{match.score2}</div>
                </div>
              </div>
            </div>
          ))}

          <div className="bg-gradient-to-r from-green-900/50 to-green-800/30 rounded-xl p-4 text-center border border-green-500/30">
            <p className="text-green-300 font-bold">
              {language === 'ar' ? 'âœ… Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø³ØªÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚' : 'âœ… Match will end in minutes'}
            </p>
          </div>
        </div>
      ) : (
        <div className="text-center">
          <div className="bg-slate-800/30 rounded-xl p-8 border border-slate-600/30">
            <div className="text-6xl mb-4">ğŸ†</div>
            <p className="text-slate-400 mb-6">
              {language === 'ar' ? 'Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠÙƒØªÙ…Ù„ 20 Ù„Ø§Ø¹Ø¨' : 'Wait for 20 players to join'}
            </p>
            {players.length >= 20 && (
              <button
                onClick={startTournament}
                className="bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition-all duration-200"
              >
                {language === 'ar' ? 'ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¢Ù†' : 'ğŸš€ Start Tournament Now'}
              </button>
            )}
          </div>
        </div>
      )}
    </div>
  );

  const renderFriendsTab = () => (
    <div className="animate-fade-in">
      <h2 className="text-3xl font-bold text-white mb-6 text-center">
        {language === 'ar' ? 'ğŸ’¬ Ø®Ø§Ù†Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡' : 'ğŸ’¬ Friends Room'}
      </h2>

      {/* Share Link */}
      <div className="bg-gradient-to-r from-blue-900/50 to-blue-800/30 rounded-xl p-4 mb-6 border border-blue-500/30">
        <p className="text-blue-300 text-sm mb-2">
          {language === 'ar' ? 'ğŸ”— Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ:' : 'ğŸ”— Share this link with your friends:'}
        </p>
        <div className="flex gap-2">
          <input
            type="text"
            value={`${window.location.origin}${window.location.pathname}`}
            readOnly
            className="flex-1 bg-slate-800/50 border border-slate-600/30 rounded-lg px-3 py-2 text-white text-sm"
          />
          <button
            onClick={() => {
              navigator.clipboard.writeText(`${window.location.origin}${window.location.pathname}`);
              alert(language === 'ar' ? 'ØªÙ… Ø§Ù„Ù†Ø³Ø®!' : 'Copied!');
            }}
            className="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg text-sm"
          >
            {language === 'ar' ? 'Ù†Ø³Ø®' : 'Copy'}
          </button>
        </div>
      </div>

      {/* Online Friends */}
      <div className="bg-slate-800/30 rounded-xl p-4 mb-4 border border-slate-600/30">
        <h3 className="text-lg font-bold text-white mb-3">
          {language === 'ar' ? 'ğŸ‘¥ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†' : 'ğŸ‘¥ Online Friends'}
        </h3>
        <div className="flex flex-wrap gap-2">
          {players.filter(p => p.isOnline).map(player => (
            <div
              key={player.id}
              className="bg-green-900/50 border border-green-500/30 rounded-full px-3 py-1 text-sm text-green-300"
            >
              {player.name}
            </div>
          ))}
          {players.filter(p => p.isOnline).length === 0 && (
            <p className="text-slate-400 text-sm">
              {language === 'ar' ? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØµØ¯Ù‚Ø§Ø¡ Ù…ØªØµÙ„ÙˆÙ†' : 'No friends online'}
            </p>
          )}
        </div>
      </div>

      {/* Chat */}
      <div className="bg-slate-800/30 rounded-xl p-4 border border-slate-600/30">
        <h3 className="text-lg font-bold text-white mb-3">
          {language === 'ar' ? 'ğŸ’¬ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©' : 'ğŸ’¬ Chat'}
        </h3>
        
        <div className="h-64 overflow-y-auto mb-4 space-y-2 pr-2">
          {messages.map(msg => {
            const isMyMessage = msg.deviceId === deviceId.current;
            return (
              <div
                key={msg.id}
                className={`flex ${isMyMessage ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[80%] rounded-lg p-3 ${
                    isMyMessage
                      ? 'bg-purple-900/50 border border-purple-500/30'
                      : 'bg-slate-700/50 border border-slate-600/30'
                  }`}
                >
                  <div className="flex items-center gap-2 mb-1">
                    <span className="text-xs font-bold text-purple-300">
                      {isMyMessage ? (language === 'ar' ? 'Ø£Ù†Øª' : 'You') : msg.user}
                    </span>
                    <span className="text-xs text-slate-500">
                      {msg.timestamp.toLocaleTimeString()}
                    </span>
                  </div>
                  <p className="text-white">{msg.text}</p>
                </div>
              </div>
            );
          })}
        </div>

        <div className="flex gap-2">
          <input
            type="text"
            value={newMessage}
            onChange={(e) => setNewMessage(e.target.value)}
            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
            placeholder={language === 'ar' ? 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...' : 'Type a message...'}
            className="flex-1 bg-slate-800/50 border border-slate-600/30 rounded-lg px-3 py-2 text-white text-sm"
          />
          <button
            onClick={sendMessage}
            className="bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded-lg text-sm"
          >
            {language === 'ar' ? 'Ø¥Ø±Ø³Ø§Ù„' : 'Send'}
          </button>
        </div>
      </div>

      {/* Instagram Link */}
      <div className="mt-6 text-center">
        <a
          href="https://www.instagram.com/_itlulp"
          target="_blank"
          rel="noopener noreferrer"
          className="inline-flex items-center gap-2 text-pink-400 hover:text-pink-300 transition-colors"
        >
          <Instagram size={20} />
          <span className="text-lg">@_itlulp</span>
        </a>
      </div>
    </div>
  );

  const renderHistoryTab = () => (
    <div className="animate-fade-in">
      <h2 className="text-3xl font-bold text-white mb-6 text-center">
        {language === 'ar' ? 'ğŸ“œ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª' : 'ğŸ“œ Match History'}
      </h2>

      <div className="space-y-3 max-h-96 overflow-y-auto pr-2">
        {gameHistory.length > 0 ? (
          gameHistory.map((match, index) => (
            <div
              key={match.id}
              className="bg-slate-800/50 rounded-xl p-4 border border-slate-600/30"
            >
              <div className="flex items-center justify-between mb-2">
                <div className="text-sm text-slate-400">
                  {language === 'ar' ? 'Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©' : 'Match'} #{index + 1}
                </div>
                <div className="text-xs bg-slate-700 px-2 py-1 rounded-full">
                  {match.stage}
                </div>
              </div>
              <div className="flex items-center justify-between">
                <div className="flex-1 text-center">
                  <div className="font-bold text-white">{match.player1}</div>
                  <div className="text-xl font-bold text-green-400">{match.score1}</div>
                </div>
                <div className="mx-4 text-slate-400">VS</div>
                <div className="flex-1 text-center">
                  <div className="font-bold text-white">{match.player2}</div>
                  <div className="text-xl font-bold text-red-400">{match.score2}</div>
                </div>
              </div>
              <div className="mt-2 text-center text-sm text-yellow-400">
                {match.score1 > match.score2 ? match.player1 : match.player2} {language === 'ar' ? 'ÙØ§Ø²!' : 'wins!'}
              </div>
            </div>
          ))
        ) : (
          <div className="text-center text-slate-400 mt-8">
            <p>{language === 'ar' ? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø³Ø§Ø¨Ù‚Ø©' : 'No matches played yet'}</p>
          </div>
        )}
      </div>
    </div>
  );

  const renderQuestionInterface = () => (
    <div className="animate-fade-in">
      <div className="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-2xl p-6 border border-slate-600/30">
        {/* Progress */}
        <div className="mb-4">
          <div className="flex justify-between text-sm text-slate-400 mb-2">
            <span>
              {language === 'ar' ? 'Ø§Ù„Ø³Ø¤Ø§Ù„' : 'Question'} {currentQuestionIndex + 1}/{questions.length}
            </span>
            <span>
              {language === 'ar' ? 'Ø§Ù„ÙˆÙ‚Øª:' : 'Time:'} {timeLeft}s
            </span>
          </div>
          <div className="w-full bg-slate-700 rounded-full h-2">
            <div
              className="bg-gradient-to-r from-green-500 to-green-400 h-2 rounded-full transition-all duration-1000"
              style={{ width: `${(timeLeft / 15) * 100}%` }}
            />
          </div>
        </div>

        {/* Lives */}
        <div className="mb-4 flex items-center gap-2">
          <span className="text-slate-400">{language === 'ar' ? 'Ø§Ù„Ø­ÙŠÙˆØ§Øª:' : 'Lives:'}</span>
          {[...Array(5)].map((_, i) => (
            <Heart
              key={i}
              size={20}
              className={i < lives ? 'text-red-500 fill-red-500' : 'text-slate-600'}
            />
          ))}
        </div>

        {/* Question */}
        <h3 className="text-xl font-bold text-white mb-6 text-center">
          {questions[currentQuestionIndex]?.question}
        </h3>

        {/* Difficulty */}
        <div className="text-center mb-6">
          <span className={`text-sm px-3 py-1 rounded-full ${
            questions[currentQuestionIndex]?.difficulty === 'easy' ? 'bg-green-900/50 text-green-300' :
            questions[currentQuestionIndex]?.difficulty === 'medium' ? 'bg-yellow-900/50 text-yellow-300' :
            'bg-red-900/50 text-red-300'
          }`}>
            {questions[currentQuestionIndex]?.difficulty === 'easy' ? (language === 'ar' ? 'Ø³Ù‡Ù„ Ø¬Ø¯Ø§Ù‹' : 'Very Easy') :
             questions[currentQuestionIndex]?.difficulty === 'medium' ? (language === 'ar' ? 'Ù…ØªÙˆØ³Ø·' : 'Medium') :
             language === 'ar' ? 'ØµØ¹Ø¨ Ù‚Ù„ÙŠÙ„Ø§Ù‹' : 'Hard'}
          </span>
        </div>

        {/* Options */}
        <div className="space-y-3">
          {questions[currentQuestionIndex]?.options.map((option, index) => (
            <button
              key={index}
              onClick={() => handleAnswer(index)}
              disabled={selectedAnswer !== null}
              className={`w-full text-right p-4 rounded-xl border transition-all duration-200 ${
                selectedAnswer === index
                  ? index === questions[currentQuestionIndex]?.correctAnswer
                    ? 'bg-green-900/50 border-green-500 text-green-300'
                    : 'bg-red-900/50 border-red-500 text-red-300'
                  : 'bg-slate-800/50 border-slate-600/30 hover:border-slate-500'
              } ${selectedAnswer !== null && index === questions[currentQuestionIndex]?.correctAnswer ? 'bg-green-900/50 border-green-500 text-green-300' : ''}`}
            >
              <span className="text-white">{option}</span>
            </button>
          ))}
        </div>

        {/* Score */}
        <div className="mt-6 text-center">
          <div className="text-2xl font-bold text-yellow-400">{score}</div>
          <div className="text-slate-400">{language === 'ar' ? 'Ø§Ù„Ù†Ù‚Ø§Ø·' : 'Score'}</div>
        </div>
      </div>
    </div>
  );

  const renderResultModal = () => (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
      <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-8 max-w-md w-full border border-slate-600">
        <h3 className="text-2xl font-bold text-white mb-4 text-center">
          {language === 'ar' ? 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠ!' : 'Challenge Complete!'}
        </h3>
        
        <div className="text-center mb-6">
          <div className="text-5xl mb-2">ğŸ‰</div>
          <div className="text-4xl font-bold text-yellow-400 mb-2">{score}</div>
          <p className="text-slate-400">
            {language === 'ar' ? 'Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©' : 'Your final score'}
          </p>
        </div>

        <p className="text-center text-white mb-6">{resultMessage}</p>

        <div className="flex gap-3">
          <button
            onClick={() => {
              setShowResult(false);
              setCurrentTab('leaderboard');
            }}
            className="flex-1 bg-purple-600 hover:bg-purple-500 text-white py-3 rounded-xl font-bold"
          >
            {language === 'ar' ? 'Ù…ØªØ§Ø¨Ø¹Ø©' : 'Continue'}
          </button>
          <button
            onClick={() => {
              setScore(0);
              setLives(5);
              setCurrentQuestionIndex(0);
              setIsPlaying(true);
              setTimeLeft(15);
              setShowResult(false);
            }}
            className="flex-1 bg-green-600 hover:bg-green-500 text-white py-3 rounded-xl font-bold"
          >
            {language === 'ar' ? 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©' : 'Try Again'}
          </button>
        </div>
      </div>
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white" dir={language === 'ar' ? 'rtl' : 'ltr'}>
      {/* Audio Element - Hidden */}
      <audio ref={audioRef} loop>
        <source src={BACKGROUND_MUSIC} type="audio/mpeg" />
      </audio>

      {/* Header */}
      <header className="sticky top-0 z-40 bg-slate-900/80 backdrop-blur-md border-b border-slate-700/50">
        <div className="container mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-lg flex items-center justify-center text-2xl">
                ğŸ†
              </div>
              <div>
                <h1 className="text-2xl font-bold bg-gradient-to-r from-yellow-400 to-yellow-500 bg-clip-text text-transparent">
                  Gowin
                </h1>
                <p className="text-xs text-slate-400">
                  {language === 'ar' ? 'Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„' : 'Champions League'}
                </p>
              </div>
            </div>

            {/* Language Toggle */}
            <button
              onClick={() => setLanguage(lang => lang === 'ar' ? 'en' : 'ar')}
              className="bg-slate-800/50 hover:bg-slate-700/50 px-4 py-2 rounded-lg border border-slate-600/30 transition-all duration-200"
            >
              <Globe size={16} className="inline mr-2" />
              {language === 'ar' ? 'EN' : 'Ø¹'}
            </button>
          </div>
        </div>
      </header>

      {/* Navigation Tabs */}
      <nav className="sticky top-[80px] z-30 bg-slate-900/90 backdrop-blur-md border-b border-slate-700/50">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center gap-2 overflow-x-auto">
            {[
              { id: 'home', icon: Home, label: language === 'ar' ? 'ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' : 'ğŸ  Home' },
              { id: 'leaderboard', icon: Trophy, label: language === 'ar' ? 'ğŸ“Š Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†' : 'ğŸ“Š Leaderboard' },
              { id: 'live', icon: Play, label: language === 'ar' ? 'ğŸ”´ Ù…Ø¨Ø§Ø´Ø±' : 'ğŸ”´ Live' },
              { id: 'history', icon: Clock, label: language === 'ar' ? 'ğŸ“œ Ø§Ù„ØªØ§Ø±ÙŠØ®' : 'ğŸ“œ History' },
              { id: 'friends', icon: Users, label: language === 'ar' ? 'ğŸ’¬ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡' : 'ğŸ’¬ Friends' }
            ].map(tab => (
              <button
                key={tab.id}
                onClick={() => setCurrentTab(tab.id as any)}
                className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all duration-200 whitespace-nowrap ${
                  currentTab === tab.id
                    ? 'bg-gradient-to-r from-purple-600 to-purple-500 text-white'
                    : 'bg-slate-800/50 text-slate-300 hover:bg-slate-700/50'
                }`}
              >
                <tab.icon size={16} />
                <span className="text-sm">{tab.label}</span>
              </button>
            ))}
          </div>
        </div>
      </nav>

      {/* Main Content */}
      <main className="container mx-auto px-4 py-6">
        {isPlaying ? renderQuestionInterface() : renderTab()}
      </main>

      {/* Result Modal */}
      {showResult && renderResultModal()}

      {/* Footer */}
      <footer className="bg-slate-900/80 border-t border-slate-700/50 mt-12">
        <div className="container mx-auto px-4 py-6">
          <div className="flex flex-col md:flex-row items-center justify-between gap-4">
            <div className="text-slate-400 text-sm">
              Â© 2024 Gowin - {language === 'ar' ? 'Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„' : 'Champions League'}
            </div>
            <a
              href="https://www.instagram.com/_itlulp"
              target="_blank"
              rel="noopener noreferrer"
              className="flex items-center gap-2 text-pink-400 hover:text-pink-300 transition-colors"
            >
              <Instagram size={20} />
              <span className="text-lg">@_itlulp</span>
            </a>
          </div>
        </div>
      </footer>

      {/* Global Styles */}
      <style jsx global>{`
        @keyframes shimmer {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(100%); }
        }
        .shimmer-animation {
          animation: shimmer 3s infinite;
        }
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        .animate-float {
          animation: float 3s ease-in-out infinite;
        }
        .animate-fade-in {
          animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .hover\:scale-\[1\.02\] {
          transition: transform 0.2s ease;
        }
        .hover\:scale-\[1\.02\]:hover {
          transform: scale(1.02);
        }
        .hover\:scale-105 {
          transition: transform 0.2s ease;
        }
        .hover\:scale-105:hover {
          transform: scale(1.05);
        }
      `}</style>
    </div>
  );
};

export default App;
